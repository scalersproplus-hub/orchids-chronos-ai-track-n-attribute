/**
 * Chronos Hyper-Pixel v2.0 (Minified)
 * First-Party Tracking | Ad-Blocker Resistant | Cookieless Fingerprinting
 */
!function(){"use strict";var e=document.currentScript||document.querySelector("script[data-pixel-id]"),t=e?e.getAttribute("data-pixel-id"):null,n=e?e.getAttribute("data-api")||window.location.origin:window.location.origin,r=e?"true"===e.getAttribute("data-debug"):false,i=e?"true"===e.getAttribute("data-session-replay"):false;if(!t)return void console.warn("[Chronos] Missing data-pixel-id");function o(){r&&console.log.apply(console,["[Chronos Pixel]"].concat(Array.prototype.slice.call(arguments)))}var a={set:function(e,t,n){n=n||365;var r=JSON.stringify(t);try{localStorage.setItem("chronos_"+e,r)}catch(t){try{sessionStorage.setItem("chronos_"+e,r)}catch(t){var i=new Date(Date.now()+864e5*n).toUTCString();document.cookie="chronos_"+e+"="+encodeURIComponent(r)+"; expires="+i+"; path=/; SameSite=Lax; Secure"}}},get:function(e){try{var t=localStorage.getItem("chronos_"+e)||sessionStorage.getItem("chronos_"+e);if(t)return JSON.parse(t)}catch(e){}try{var n=document.cookie.match(new RegExp("chronos_"+e+"=([^;]+)"));if(n)return JSON.parse(decodeURIComponent(n[1]))}catch(e){}return null}};function s(e){var t=(new TextEncoder).encode(e);return crypto.subtle.digest("SHA-256",t).then(function(e){return Array.from(new Uint8Array(e)).map(function(e){return e.toString(16).padStart(2,"0")}).join("")})}var c={generate:function(){var e=this;return Promise.all([e.getCanvasFingerprint(),e.getWebGLFingerprint(),e.getAudioFingerprint(),e.getFontsFingerprint()]).then(function(t){var n=t.concat([e.getScreenInfo(),e.getDeviceInfo(),e.getBrowserFeatures(),e.getTimezoneInfo(),e.getHardwareInfo(),e.getConnectionInfo(),e.getPluginsInfo()]).filter(Boolean).join("|");return s(n).then(function(e){return"fp_"+e.substring(0,32)})})},getCanvasFingerprint:function(){return new Promise(function(e){try{var t=document.createElement("canvas");t.width=280,t.height=60;var n=t.getContext("2d");n?(n.textBaseline="top",n.font="16px Arial, sans-serif",n.fillStyle="#f60",n.fillRect(125,1,62,20),n.fillStyle="#069",n.fillText("Chronos HyperPixel",2,15),n.fillStyle="rgba(102, 204, 0, 0.7)",n.fillText("Chronos HyperPixel",4,17),n.globalCompositeOperation="multiply",n.fillStyle="rgb(255,0,255)",n.beginPath(),n.arc(50,50,50,0,2*Math.PI,!0),n.closePath(),n.fill(),e(t.toDataURL().slice(-100))):e("nc")}catch(t){e("ce")}})},getWebGLFingerprint:function(){return new Promise(function(e){try{var t=document.createElement("canvas"),n=t.getContext("webgl")||t.getContext("experimental-webgl");if(!n)return void e("nw");var r=n.getExtension("WEBGL_debug_renderer_info");r?e(n.getParameter(r.UNMASKED_VENDOR_WEBGL)+"|"+n.getParameter(r.UNMASKED_RENDERER_WEBGL)+"|"+n.getParameter(n.MAX_TEXTURE_SIZE)+"|"+n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE)):e("nd")}catch(t){e("we")}})},getAudioFingerprint:function(){return new Promise(function(e){try{var t=window.AudioContext||window.webkitAudioContext;if(!t)return void e("na");var n=new t,r=n.createOscillator(),i=n.createDynamicsCompressor();r.type="triangle",r.frequency.value=1e4,i.threshold.value=-50,i.knee.value=40,i.ratio.value=12,i.attack.value=0,i.release.value=.25,r.connect(i),i.connect(n.destination),r.start(0),setTimeout(function(){var t=i.reduction.value||0;r.disconnect(),i.disconnect(),n.close(),e(t.toString())},100)}catch(t){e("ae")}})},getFontsFingerprint:function(){return new Promise(function(e){try{var t=["monospace","sans-serif","serif"],n=["Arial","Verdana","Times New Roman","Courier New","Georgia","Comic Sans MS","Trebuchet MS","Impact","Calibri","Monaco"],r=document.createElement("canvas"),i=r.getContext("2d");if(!i)return void e("nf");var o={};t.forEach(function(e){i.font="72px "+e,o[e]=i.measureText("mmmmmmmmmmlli").width});var a=[];n.forEach(function(e){t.forEach(function(t){i.font="72px "+e+", "+t,-1===a.indexOf(e)&&i.measureText("mmmmmmmmmmlli").width!==o[t]&&a.push(e)})}),e(a.join(",")||"none")}catch(t){e("fe")}})},getScreenInfo:function(){return[screen.width,screen.height,screen.colorDepth,screen.pixelDepth,window.devicePixelRatio||1,screen.orientation?screen.orientation.type:"unknown"].join("x")},getDeviceInfo:function(){return[navigator.platform,navigator.hardwareConcurrency||0,navigator.maxTouchPoints||0,navigator.vendor,"ontouchstart"in window?1:0].join("~")},getBrowserFeatures:function(){return["localStorage"in window,"sessionStorage"in window,"indexedDB"in window,"WebAssembly"in window,"Worker"in window,"ServiceWorker"in navigator,"WebGL"in window||!!document.createElement("canvas").getContext("webgl"),"RTCPeerConnection"in window,"speechSynthesis"in window,"Bluetooth"in navigator,"credentials"in navigator].map(function(e){return e?"1":"0"}).join("")},getTimezoneInfo:function(){try{var e=Intl.DateTimeFormat().resolvedOptions();return e.timeZone+"|"+(new Date).getTimezoneOffset()+"|"+(e.locale||"unknown")}catch(e){return"unknown"}},getHardwareInfo:function(){var e=performance.memory;return[navigator.hardwareConcurrency||"unknown",e?e.jsHeapSizeLimit:"unknown",navigator.deviceMemory||"unknown"].join("|")},getConnectionInfo:function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return e?(e.effectiveType||"unknown")+"|"+(e.downlink||0)+"|"+(e.rtt||0):"nc"},getPluginsInfo:function(){try{var e=Array.from(navigator.plugins||[]);return e.length+":"+e.slice(0,5).map(function(e){return e.name}).join(",")}catch(e){return"np"}},getOrCreate:function(){var e=this,t=a.get("fingerprint");return t?Promise.resolve(t):e.generate().then(function(e){return a.set("fingerprint",e),e})}},l={analyze:function(){var e=0,t=[];return(navigator.webdriver||document.__webdriver_script_fn)&&(e+=40,t.push("webdriver")),navigator.plugins&&0!==navigator.plugins.length||(e+=25,t.push("no_plugins")),/bot|crawler|spider|scraper|headless|phantom|selenium|puppeteer|playwright/i.test(navigator.userAgent)&&(e+=35,t.push("bot_ua")),(screen.width<100||screen.height<100)&&(e+=20,t.push("suspicious_screen")),0===window.outerWidth&&0===window.outerHeight&&(e+=30,t.push("hidden_window")),!window.chrome&&navigator.userAgent.indexOf("Chrome")>-1&&(e+=15,t.push("fake_chrome")),{score:e,signals:t,isBot:e>=50}}},u={extract:function(){var e=new URLSearchParams(window.location.search),t={};return["gclid","gbraid","wbraid","fbclid","ttclid","msclkid","li_fat_id","twclid"].forEach(function(n){var r=e.get(n);r?(t[n]=r,a.set(n,r,90)):(r=a.get(n))&&(t[n]=r)}),["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach(function(n){var r=e.get(n);r?(t[n]=r,a.set(n,r,30)):(r=a.get(n))&&(t[n]=r)}),function(){try{var e=document.cookie.split(";").reduce(function(e,t){var n=t.trim().split("=");return e[n[0]]=n[1],e},{});e._fbc&&(t.fbc=e._fbc),e._fbp&&(t.fbp=e._fbp)}catch(e){}}(),t}},d={collect:function(){var e=navigator.userAgent,t=/iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(e),n=/iPad|Android(?!.*Mobile)/i.test(e),r=n?"tablet":t?"mobile":"desktop",i="Unknown";e.indexOf("Firefox")>-1?i="Firefox":e.indexOf("SamsungBrowser")>-1?i="Samsung":e.indexOf("Opera")>-1||e.indexOf("OPR")>-1?i="Opera":e.indexOf("Edg")>-1?i="Edge":e.indexOf("Chrome")>-1?i="Chrome":e.indexOf("Safari")>-1&&(i="Safari");var o="Unknown";return e.indexOf("Windows NT 10")>-1?o="Windows 10/11":e.indexOf("Mac OS")>-1?o="macOS":e.indexOf("Android")>-1?o="Android":e.indexOf("iOS")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1?o="iOS":e.indexOf("Linux")>-1&&(o="Linux"),{deviceType:r,browser:i,os:o,userAgent:e,screen:screen.width+"x"+screen.height,viewport:window.innerWidth+"x"+window.innerHeight,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone}}},f={events:[],recording:!1,maxEvents:200,start:function(){if(!this.recording){this.recording=!0;var e=this;document.addEventListener("click",function(t){e.events.push({type:"click",x:t.clientX,y:t.clientY,target:t.target.tagName+(t.target.id?"#"+t.target.id:""),ts:Date.now()}),e.checkSize()},!0),document.addEventListener("scroll",function(){e.events.push({type:"scroll",scrollY:window.scrollY,scrollPercent:Math.round(window.scrollY/(document.body.scrollHeight-window.innerHeight)*100),ts:Date.now()}),e.checkSize()},{passive:!0}),o("Session replay started")}},checkSize:function(){this.events.length>=this.maxEvents&&(p.track("SessionReplay",{session_id:p.sessionId,replay_events:this.events.slice()}),this.events=[])},flush:function(){return this.events.length>0?{session_id:p.sessionId,replay_events:this.events.slice()}:null}},p={queue:[],processing:!1,sessionId:"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),flushTimer:null,track:function(e,t){var r=this;t=t||{},c.getOrCreate().then(function(i){var a=u.extract(),s=d.collect(),c=l.analyze();if(!c.isBot||!(c.score>80)){var f={pixel_id:t,event_name:e,event_id:e+"_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),timestamp:(new Date).toISOString(),fingerprint_id:i,session_id:r.sessionId,page_url:window.location.href,page_path:window.location.pathname,page_title:document.title,referrer:document.referrer,fraud_score:c.score,fraud_signals:c.signals};Object.keys(a).forEach(function(e){f[e]=a[e]}),Object.keys(s).forEach(function(e){f[e]=s[e]}),Object.keys(t).forEach(function(e){f[e]=t[e]}),r.queue.push(f),o("Event queued:",e,f),["Purchase","Lead","CompleteRegistration","Subscribe"].indexOf(e)>-1?r.flush():r.flushTimer||(r.flushTimer=setTimeout(function(){r.flush()},2e3))}})},flush:function(){var e=this;if(!e.processing&&0!==e.queue.length){e.processing=!0,e.flushTimer&&(clearTimeout(e.flushTimer),e.flushTimer=null);var t=e.queue.slice();e.queue=[];var r=JSON.stringify({events:t});if(navigator.sendBeacon){var i=new Blob([r],{type:"application/json"});if(navigator.sendBeacon(n+"/api/pixel/events",i))return o("Events sent via beacon:",t.length),void(e.processing=!1)}fetch(n+"/api/pixel/events",{method:"POST",headers:{"Content-Type":"application/json"},body:r,keepalive:!0,credentials:"include"}).then(function(e){if(!e.ok)throw new Error("HTTP "+e.status);o("Events sent via fetch:",t.length)}).catch(function(n){o("Failed to send events:",n),e.queue=t.concat(e.queue)}).finally(function(){e.processing=!1})}}},g={track:function(e,t){p.track(e,t)},pageView:function(e){p.track("PageView",e)},viewContent:function(e){p.track("ViewContent",e)},addToCart:function(e){p.track("AddToCart",e)},initiateCheckout:function(e){p.track("InitiateCheckout",e)},purchase:function(e){p.track("Purchase",e)},lead:function(e){p.track("Lead",e)},completeRegistration:function(e){p.track("CompleteRegistration",e)},search:function(e){p.track("Search",e)},subscribe:function(e){p.track("Subscribe",e)},identify:function(e){a.set("user_data",e),p.track("Identify",{user_data:e})},getFingerprint:function(){return c.getOrCreate()},getSessionId:function(){return p.sessionId},debug:function(e){r=e}};function h(){o("Initializing Chronos Hyper-Pixel v2.0...");var e=function(){var e=0;try{e=performance.timing.loadEventEnd-performance.timing.navigationStart}catch(e){}p.track("PageView",{page_load_time:e})};"complete"===document.readyState?e():window.addEventListener("load",e),i&&f.start();var t=history.pushState,r=history.replaceState;history.pushState=function(){t.apply(this,arguments),setTimeout(function(){p.track("PageView",{spa:!0})},0)},history.replaceState=function(){r.apply(this,arguments),setTimeout(function(){p.track("PageView",{spa:!0})},0)},window.addEventListener("popstate",function(){p.track("PageView",{spa:!0})}),window.addEventListener("beforeunload",function(){if(p.flush(),f.recording){var e=f.flush();e&&navigator.sendBeacon(n+"/api/pixel/events",new Blob([JSON.stringify({events:[{pixel_id:t,event_name:"SessionReplay",session_id:p.sessionId,replay_events:e.replay_events}]})],{type:"application/json"}))}}),document.addEventListener("click",function(e){var t=e.target.closest?e.target.closest("a"):null;if(t&&t.href)try{var n=new URL(t.href);if(n.hostname!==window.location.hostname){var r=a.get("fingerprint");r&&n.searchParams.set("_chronos_id",r),n.searchParams.set("_chronos_session",p.sessionId);var i=new URLSearchParams(window.location.search);["utm_source","utm_medium","utm_campaign","utm_content","utm_term"].forEach(function(e){var t=i.get(e)||a.get(e);t&&n.searchParams.set(e,t)}),t.href=n.toString()}}catch(e){}});var s=new URLSearchParams(window.location.search),c=s.get("_chronos_id"),l=s.get("_chronos_session");c&&a.set("fingerprint",c),l&&a.set("linked_session",l),o("Chronos Hyper-Pixel initialized. Pixel ID:",t)}window.chronos=g,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",h):h()}();
